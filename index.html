<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Workbench</title>
    <link rel="stylesheet" href="app.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
</head>
<body>
    <div class="container">
        <div class="file-browser">
            <div class="file-tree" id="fileTree"></div>
            <div class="file-section collapsed" id="fileSection">
                <div class="file-toggle" onclick="toggleFileSection()">
                    <div class="file-status">
                        <span class="file-indicator" id="fileIndicator"></span>
                        <span>File Browser Settings</span>
                    </div>
                    <span class="file-toggle-icon">▲</span>
                </div>
                <div class="file-controls">
                    <button class="btn" id="importZipBtn">Import ZIP</button>
                    <button class="btn" id="exportZipBtn">Export ZIP</button>
                    <button class="btn btn-danger" id="clearFilesBtn" onclick="if(confirm('Clear all files?')) window.fileBrowser.clearAllFiles()">Clear Files</button>
                </div>
                <div class="github-controls">
                    <input type="password" id="githubToken" placeholder="GitHub Personal Access Token">
                    <button class="btn" id="saveGithubToken">Connect</button>
                </div>
                <div class="github-repo-controls">
                    <select id="ownerSelect" disabled>
                        <option value="">Select User/Org</option>
                    </select>
                    <select id="repoSelect" disabled>
                        <option value="">Select Repository</option>
                    </select>
                    <select id="branchSelect" disabled>
                        <option value="">Select Branch</option>
                    </select>
                    <div class="github-actions">
                        <button class="btn" id="pullBtn" disabled>Pull</button>
                        <button class="btn btn-primary" id="pushBtn" disabled>Push</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="right-panel">
            <div class="tab-bar" id="tabBar" style="display: none;">
                <div class="tab chat-tab active" data-tab="chat">Chat</div>
            </div>
            <div class="tab-content" id="tabContent">
                <div class="tab-pane active" id="chat-pane">
                    <div class="chat-panel">
                        <div class="chat-window" id="chatWindow"></div>
                        <div class="message-input">
                            <textarea id="messageInput" placeholder="Type your message here... (Enter to send, Shift+Enter for new line)" onkeydown="if(event.key === 'Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); }"></textarea>
                            <button class="btn btn-primary" id="sendBtn" onclick="sendMessage()">Send</button>
                        </div>
                        <div class="api-section collapsed" id="apiSection">
                <div class="api-toggle" onclick="toggleApiSection()">
                    <div class="api-status">
                        <span class="api-indicator" id="apiIndicator"></span>
                        <span id="apiStatusText">API Settings</span>
                        <span id="modelDisplay" style="color: #007acc; margin-left: 10px;"></span>
                        <span id="tokenDisplay" style="color: #b8960f; margin-left: 10px;"></span>
                    </div>
                    <span class="api-toggle-icon">▲</span>
                </div>
                <div class="api-controls">
                    <select id="providerSelect" style="padding: 8px; background-color: #2a2a2a; border: 1px solid #3a3a3a; color: #e0e0e0; border-radius: 4px; width: 100px;">
                        <option value="claude">Claude</option>
                        <option value="openai">OpenAI</option>
                        <option value="gemini">Gemini</option>
                        <option value="ollama">Ollama</option>
                    </select>
                    <select id="modelSelect" style="padding: 8px; background-color: #2a2a2a; border: 1px solid #3a3a3a; color: #e0e0e0; border-radius: 4px; width: 130px;">
                        <!-- Will be populated based on provider -->
                    </select>
                    <input type="password" id="apiKey" placeholder="Enter API Key (auto-saves)" style="flex: 1;">
                </div>
                <div class="chat-controls">
                    <div class="chat-buttons" style="width: 100%; display: flex; justify-content: space-between;">
                        <div style="display: flex; gap: 10px;">
                            <button class="btn" id="systemPromptBtn" onclick="window.chat.openSystemPromptEditor()">System Prompt</button>
                            <button class="btn" id="toolsPromptBtn" onclick="window.chat.openToolsViewer()">Tools</button>
                            <button class="btn" id="envPromptBtn" onclick="window.chat.openEnvironmentEditor()">Environment</button>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center; flex: 1; justify-content: center;">
                            <label class="chat-control-label chat-control-number">
                                <span class="chat-control-text">Tool Iterations</span>
                                <input type="number" id="maxIterations" min="1" max="50" value="10"
                                       class="chat-control-input"
                                       onchange="window.chat && window.chat.updateMaxIterations(this.value)"
                                       title="Maximum tool call iterations before pausing">
                            </label>
                            <label class="chat-control-label chat-control-toggle">
                                <input type="checkbox" id="minimizeTokensToggle" class="chat-toggle-input" checked>
                                <span class="chat-toggle-indicator" aria-hidden="true"></span>
                                <span class="chat-control-text">Summarize Tools</span>
                            </label>
                            <label id="limitMessagesContainer" class="chat-control-label chat-control-number">
                                <span class="chat-control-text">Limit Messages</span>
                                <input type="number" id="limitMessagesInput" min="0" value="5"
                                       class="chat-control-input"
                                       title="Only send the last N user messages">
                            </label>
                        </div>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <button class="btn" id="exportChatBtn" onclick="window.chat.exportChatHistory()">Export Chat</button>
                            <button class="btn" id="importChatBtn" onclick="document.getElementById('chatHistoryInput').click()">Import Chat</button>
                            <button class="btn btn-danger" id="clearChatBtn" onclick="if(confirm('Clear all messages?')) window.chat.clearChat()">Clear Chat</button>
                        </div>
                    </div>
                </div>
            </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <input type="file" id="fileInput" multiple>
    <input type="file" id="zipInput" accept=".zip">
    <input type="file" id="contextFileInput" multiple webkitdirectory>
    <input type="file" id="chatHistoryInput" accept=".json">

    <!-- Generic Info Viewer Modal -->
    <div id="infoViewerModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="infoViewerTitle">Information</h2>
                <span class="modal-close" onclick="window.chat.closeInfoViewer()">&times;</span>
            </div>
            <div class="modal-body">
                <textarea id="infoViewerContent" readonly placeholder="Loading..."></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="window.chat.copyInfoContent(event)">Copy</button>
            </div>
        </div>
    </div>

    <!-- Environment Editor Modal -->
    <div id="environmentModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Environment</h2>
                <span class="modal-close" onclick="window.chat.closeEnvironmentEditor()">&times;</span>
            </div>
            <div class="modal-body">
                <textarea id="environmentEditor" placeholder="Enter environment information to send with messages (optional)..."></textarea>
            </div>
        </div>
    </div>

    <!-- System Prompt Modal -->
    <div id="systemPromptModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>System Prompt</h2>
                <span class="modal-close" onclick="window.chat.closeSystemPromptEditor()">&times;</span>
            </div>
            <div class="modal-body">
                <textarea id="systemPromptEditor" placeholder="Enter system prompt to set the AI's behavior and context..."></textarea>
            </div>
            <div class="modal-footer" style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: space-between; align-items: center;">
                <div style="flex: 1; display: flex; justify-content: flex-start;">
                    <button class="btn btn-secondary" onclick="window.chat.resetSystemPrompt()">Reset to Default</button>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button class="btn btn-primary" onclick="window.chat.saveSystemPrompt()">Save</button>
                    <button class="btn" onclick="window.chat.closeSystemPromptEditor()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Script Inclusion Modal -->
    <div id="scriptInclusionModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Include Script in HTML Files</h2>
                <span class="modal-close" onclick="window.scriptInclusionModal.cancel()">&times;</span>
            </div>
            <div class="modal-body" style="padding: 20px;">
                <p style="margin-bottom: 15px;">Select HTML files to include <span id="scriptFileName" style="font-weight: bold;"></span>:</p>
                <div id="htmlFilesList" style="max-height: 300px; overflow-y: auto; border: 1px solid #3a3a3a; border-radius: 4px; padding: 10px; background-color: #2a2a2a;">
                    <!-- Checkboxes will be added here dynamically -->
                </div>
            </div>
            <div class="modal-footer" style="display: flex; justify-content: space-between; align-items: center;">
                <label class="theme-checkbox theme-checkbox--inline">
                    <input type="checkbox" id="rememberScriptChoice" class="theme-checkbox-input">
                    <span class="theme-checkbox-indicator" aria-hidden="true"></span>
                    <span class="theme-checkbox-text">Remember my choice</span>
                </label>
                <button class="btn btn-primary" onclick="window.scriptInclusionModal.proceed()">Add to Selected Files</button>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div id="contextMenu" class="context-menu">
        <div class="context-menu-item" data-action="new-file">New File</div>
        <div class="context-menu-item" data-action="new-folder">New Folder</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" data-action="upload-files">Upload Files</div>
        <div class="context-menu-item" data-action="upload-folder">Upload Folder</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" data-action="rename">Rename</div>
        <div class="context-menu-item" data-action="delete">Delete</div>
        <div class="context-menu-item" data-action="download">Download</div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.32.2/ace.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-beautify/1.14.11/beautify-html.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/11.1.1/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="FileSystemManager.js"></script>
    <script src="FileBrowserUI.js"></script>
    <script src="GitHubIntegration.js"></script>
    <script src="WorkbenchTools.js"></script>
    <script src="TabManager.js"></script>
    <script src="AIProviders.js"></script>
    <script src="ChatClient.js"></script>
    <script src="app.js"></script>
</body>
</html>
